# Pre-commit hooks configuration for local development validation
# Mirrors GitHub Actions CI/CD pipeline checks locally
# Run automatically before git push to catch issues early
#
# Setup: make setup-hooks
# Run manually: make run-hooks
# Uninstall: make uninstall-hooks
#
# See ADR-004 for decision rationale: docs/adr/004-local-pre-commit-hooks-for-development-validation.md
#
# Note: Linting (shellcheck, yamllint, pymarkdown) runs in pre-commit hook via scripts/pre-commit-lint.sh
#       Pre-push only runs expensive checks (build, HTML validation, secrets, links)

repos:
  # Secret scanning (prevent accidental credential commits)
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: detect-secrets
        description: Prevent secrets from being committed
        args: ['--baseline', '.secrets.baseline']
        stages: [push]
        exclude: |
          (?x)^(
            website/public/|
            \.secrets\.baseline$
          )

  # Custom hooks
  - repo: local
    hooks:
      # Python linting and testing
      - id: ruff-check
        name: ruff-check
        description: Run ruff linter on Python files
        entry: .venv/bin/ruff check
        language: system
        files: \.py$
        stages: [commit]

      - id: pytest
        name: pytest
        description: Run pytest on Python test files
        entry: .venv/bin/pytest
        language: system
        files: ^scripts/.*\.py$
        stages: [commit]
        pass_filenames: false

      # Hugo build validation
      - id: hugo-build
        name: hugo-build
        description: Validate Hugo build (dev mode)
        entry: bash -c 'cd website && hugo && cd ..'
        language: system
        pass_filenames: false
        always_run: true
        stages: [push]
        exclude: ^website/(archetypes|README.md)

      # HTML validation with change detection
      - id: html-validation
        name: html-validation
        description: Validate HTML using html5lib (pure Python)
        entry: scripts/test-html.sh
        language: script
        pass_filenames: false
        files: ^website/(layouts/|content/|archetypes/|hugo\.toml)
        stages: [push]

      # Custom link validation
      - id: critical-links
        name: critical-links
        description: Validate critical internal links
        entry: scripts/pre-push-link-checker.sh
        language: script
        pass_filenames: false
        always_run: true
        stages: [push]

# Global settings
exclude: |
  (?x)^(
    website/(public|resources)/|
    \.git/|
    \.pre-commit/
  )
fail_fast: false
minimum_pre_commit_version: '2.15.0'
