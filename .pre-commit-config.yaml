# Pre-commit hooks configuration for local development validation
# Mirrors GitHub Actions CI/CD pipeline checks locally
# Run automatically before git push to catch issues early
#
# Setup: make setup-hooks
# Run manually: make run-hooks
# Uninstall: make uninstall-hooks
#
# See ADR-004 for decision rationale: docs/adr/004-local-pre-commit-hooks-for-development-validation.md

repos:
  # Shell script linting
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.9.0.7
    hooks:
      - id: shellcheck
        name: shellcheck
        description: Shell script linting
        entry: shellcheck
        language: python
        types: [shell]
        args: [--format=gcc]

  # YAML linting
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1
    hooks:
      - id: yamllint
        name: yamllint
        description: YAML linting
        entry: yamllint
        language: python
        types: [yaml]
        args: [--config-file=.github/yamllint-config.yml]

  # Markdown linting
  - repo: https://github.com/jackdewinter/pymarkdown
    rev: v0.9.22
    hooks:
      - id: pymarkdown
        name: pymarkdown
        description: Markdown linting (Python-based)
        entry: pymarkdown
        language: python
        types: [markdown]
        args: [scan]

  # TOML linting (Hugo configuration)
  - repo: https://github.com/pre-commit/mirrors-pip-tools
    rev: v7.4.0
    hooks:
      - id: pip-compile
        name: pip-compile
        entry: python -m tomli
        language: system
        types: [toml]
        pass_filenames: true
        always_run: false

  # Secret scanning (prevent accidental credential commits)
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: detect-secrets
        description: Prevent secrets from being committed
        args: ['--baseline', '.secrets.baseline']
        exclude: |
          (?x)^(
            website/public/|
            \.secrets\.baseline$
          )

  # Custom hooks
  - repo: local
    hooks:
      # Hugo build validation
      - id: hugo-build
        name: hugo-build
        description: Validate Hugo build (dev mode)
        entry: bash -c 'docker run --rm -v "$PWD/website:/site" -w /site alpine:3.20.2 sh -c "wget -q -O - https://github.com/gohugoio/hugo/releases/download/v0.128.2/hugo_0.128.2_linux-amd64.tar.gz | tar xz && ./hugo --config hugo.toml -s /site"'
        language: system
        pass_filenames: false
        always_run: true
        stages: [push]
        exclude: ^website/(archetypes|README.md)

      # HTML validation (errors only)
      - id: html-validation
        name: html-validation
        description: Validate generated HTML structure
        entry: bash -c 'if command -v html5validator &> /dev/null; then find website/public -name "*.html" -type f -exec html5validator --show-warnings off {} +; fi'
        language: system
        pass_filenames: false
        always_run: true
        stages: [push]

      # Custom link validation
      - id: critical-links
        name: critical-links
        description: Validate critical internal links
        entry: scripts/pre-push-link-checker.sh
        language: script
        pass_filenames: false
        always_run: true
        stages: [push]

# Global settings
exclude: |
  (?x)^(
    website/(public|resources)/|
    \.git/|
    \.pre-commit/
  )
fail_fast: false
minimum_pre_commit_version: '2.15.0'
