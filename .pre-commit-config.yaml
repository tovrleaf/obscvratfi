# Pre-commit hooks configuration for local development validation
# Mirrors GitHub Actions CI/CD pipeline checks locally
# Run automatically before git push to catch issues early
#
# Setup: make setup-hooks
# Run manually: make run-hooks
# Uninstall: make uninstall-hooks
#
# See ADR-004 for decision rationale: docs/adr/004-local-pre-commit-hooks-for-development-validation.md
#
# Note: Linting (shellcheck, yamllint, pymarkdown) runs in pre-commit hook via scripts/pre-commit-lint.sh
#       Pre-push only runs expensive checks (build, HTML validation, secrets, links)

repos:
  # Secret scanning (prevent accidental credential commits)
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: detect-secrets
        description: Prevent secrets from being committed
        args: ['--baseline', '.secrets.baseline']
        stages: [push]
        exclude: |
          (?x)^(
            website/public/|
            \.secrets\.baseline$
          )

  # Custom hooks
  - repo: local
    hooks:
      # Hugo build validation
      - id: hugo-build
        name: hugo-build
        description: Validate Hugo build (dev mode)
        entry: bash -c 'cd website && docker run --rm -v "$PWD:/site" -w /site alpine:3.20.2 sh -c "wget -q -O - https://github.com/gohugoio/hugo/releases/download/v0.128.2/hugo_0.128.2_linux-amd64.tar.gz | tar xz && ./hugo --config hugo.toml && rm -f hugo LICENSE" && cd ..'
        language: system
        pass_filenames: false
        always_run: true
        stages: [push]
        exclude: ^website/(archetypes|README.md)

      # HTML validation (errors only)
      - id: html-validation
        name: html-validation
        description: Validate generated HTML structure
        entry: bash -c 'if command -v html5validator &> /dev/null; then find website/public -name "*.html" -type f -exec html5validator --show-warnings off {} +; fi'
        language: system
        pass_filenames: false
        always_run: true
        stages: [push]

      # Custom link validation
      - id: critical-links
        name: critical-links
        description: Validate critical internal links
        entry: scripts/pre-push-link-checker.sh
        language: script
        pass_filenames: false
        always_run: true
        stages: [push]

# Global settings
exclude: |
  (?x)^(
    website/(public|resources)/|
    \.git/|
    \.pre-commit/
  )
fail_fast: false
minimum_pre_commit_version: '2.15.0'
