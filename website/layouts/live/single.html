{{ define "main" }}
<article class="gig-detail">
    <h1 class="page-title">Live</h1>
    <nav class="page-nav">
        {{ with .PrevInSection }}<a href="{{ .Permalink }}" class="nav-prev">⇜</a>{{ else }}<span class="nav-disabled">⇜</span>{{ end }}<a href="/live/" class="nav-back">↑</a>{{ with .NextInSection }}<a href="{{ .Permalink }}" class="nav-next">⇝</a>{{ else }}<span class="nav-disabled">⇝</span>{{ end }}
    </nav>
    
    <!-- Hero Section: Poster + Overlaid Info -->
    <div class="gig-hero">
        <div class="gig-hero-poster">
            <div class="info-card card-title">
                <h1>{{ .Title }}</h1>
            </div>
            
            {{ if .Params.poster }}
            <div class="poster-wrapper">
                {{ $gigSlug := .File.BaseFileName }}
                {{ $posterFilename := path.Base .Params.poster }}
                {{ $posterPath := printf "media/live/%s/%s" $gigSlug $posterFilename }}
                {{ $resource := resources.Get $posterPath }}
                {{ if $resource }}
                {{ $small := $resource.Resize "400x q85" }}
                {{ $medium := $resource.Resize "800x q85" }}
                {{ $large := $resource.Resize "1200x q85" }}
                {{ $lightbox := $resource.Resize "1600x q90" }}
                <a href="#" class="open-lightbox"
                   data-image-url="{{ $lightbox.RelPermalink }}"
                   data-original-url="{{ $resource.RelPermalink }}"
                   data-gig-title="{{ .Title }}"
                   data-gig-link="{{ .Permalink }}">
                    <img srcset="{{ $small.RelPermalink }} 400w,
                                 {{ $medium.RelPermalink }} 800w,
                                 {{ $large.RelPermalink }} 1200w"
                         sizes="(max-width: 768px) 100vw, 800px"
                         src="{{ $medium.RelPermalink }}"
                         alt="{{ .Title }} poster"
                         class="poster-image"
                         loading="lazy">
                </a>
                {{ end }}
            </div>
            {{ end }}
        </div>
        
        <div class="gig-hero-info">
            <div class="info-card card-date">
                <span class="label">Date</span>
                <span class="value">{{ .Date | dateFormat "January 2, 2006" }}</span>
            </div>
            
            <div class="info-card card-venue">
                <span class="label">Venue</span>
                <span class="value">{{ .Params.venue }}</span>
                <span class="sublabel">{{ .Params.location }}</span>
            </div>
            
            {{ if .Params.other_performers }}
            <div class="info-card card-performers">
                <span class="label">Also performing</span>
                {{ range .Params.other_performers }}
                <span class="performer">
                    {{ if .url }}
                        <a href="{{ .url }}" target="_blank">{{ .name }}</a>
                    {{ else }}
                        {{ .name }}
                    {{ end }}
                </span>
                {{ end }}
            </div>
            {{ end }}
            
            {{ if .Params.event_link }}
            <div class="info-card card-link">
                <a href="{{ .Params.event_link }}" target="_blank" class="event-link">View Event Page</a>
            </div>
            {{ end }}
        </div>
    </div>

    <!-- Description -->
    {{ if .Content }}
    <div class="gig-description">
        {{ .Content }}
    </div>
    {{ end }}

    <!-- Diagonal Divider -->
    <div class="diagonal-divider"></div>

    <!-- Media Gallery -->
    {{ if .Params.media }}
    <div class="gig-media">
        <section class="media-section">
            <h2>
                {{ if and .Params.media.pictures .Params.media.videos }}
                    Photos & Videos
                {{ else if .Params.media.pictures }}
                    Photos
                {{ else if .Params.media.videos }}
                    Videos
                {{ end }}
            </h2>
            {{ if .Params.media.pictures.author }}
            <p class="media-credit">
                Photos by 
                {{ if .Params.media.pictures.author_url }}
                    <a href="{{ .Params.media.pictures.author_url }}" target="_blank">{{ .Params.media.pictures.author }}</a>
                {{ else }}
                    {{ .Params.media.pictures.author }}
                {{ end }}
            </p>
            {{ end }}
            <div class="media-grid">
                {{ if .Params.media.pictures }}
                {{ $gigSlug := .File.BaseFileName }}
                {{ $gigTitle := .Title }}
                {{ $gigPermalink := .Permalink }}
                {{ $author := .Params.media.pictures.author }}
                {{ $authorUrl := .Params.media.pictures.author_url }}
                {{ $location := .Params.location }}
                {{ $date := .Date.Format "January 2, 2006" }}
                {{ range .Params.media.pictures.images }}
                    {{ $imagePath := printf "media/live/%s/%s" $gigSlug . }}
                    {{ with resources.Get $imagePath }}
                        {{ $altText := printf "Obscvrat live at %s, %s, %s - Photo by %s" $gigTitle $location $date $author }}
                        {{ $thumb := .Resize "400x q85" }}
                        {{ $lightbox := .Resize "1600x q90" }}
                        <div class="media-item photo-item">
                            <a href="#" class="open-lightbox" 
                               data-image-url="{{ $lightbox.RelPermalink }}"
                               data-original-url="{{ .RelPermalink }}"
                               data-gig-title="{{ $gigTitle }}"
                               data-gig-link="{{ $gigPermalink }}"
                               data-author="{{ $author }}"
                               data-author-url="{{ $authorUrl }}">
                                <img src="{{ $thumb.RelPermalink }}" alt="{{ $altText }}" loading="lazy">
                                <div class="photo-overlay">
                                    <span class="photo-meta">{{ $author }}</span>
                                </div>
                            </a>
                        </div>
                    {{ end }}
                {{ end }}
                {{ end }}
                
                {{ if .Params.media.videos }}
                {{ $gigTitle := .Title }}
                {{ $gigPermalink := .Permalink }}
                {{ range .Params.media.videos }}
                    <div class="media-item video-item">
                        <a href="#" class="open-video-lightbox"
                           data-youtube-id="{{ .youtube_id }}"
                           data-title="{{ .title }}"
                           data-gig-title="{{ $gigTitle }}"
                           data-gig-link="{{ $gigPermalink }}"
                           {{ if .credits }}
                           data-credits='{{ .credits | jsonify }}'
                           {{ end }}>
                            <img src="https://img.youtube.com/vi/{{ .youtube_id }}/mqdefault.jpg" alt="{{ .title }}">
                            <div class="play-icon">▶</div>
                        </a>
                        <div class="media-info">
                            {{ if .title }}<p class="media-title">{{ .title }}</p>{{ end }}
                        </div>
                    </div>
                {{ end }}
                {{ end }}
            </div>
        </section>
    </div>
    {{ end }}

    <!-- Press & Media -->
    {{ $gigSlug := .File.BaseFileName }}
    {{ $othersPage := .Site.GetPage "/media/others.md" }}
    {{ if $othersPage }}
        {{ $relatedItems := slice }}
        {{ range $othersPage.Params.items }}
            {{ if eq .gig $gigSlug }}
                {{ $relatedItems = $relatedItems | append . }}
            {{ end }}
        {{ end }}
        {{ if gt (len $relatedItems) 0 }}
        <div class="diagonal-divider"></div>
        <div class="gig-others">
            <h2>Press & Media</h2>
            <ul>
            {{ range $relatedItems }}
                <li class="press-item">
                    <span class="press-type">{{ .type }}</span>
                    <a href="{{ .url }}" target="_blank" class="press-link">{{ .title }}</a>
                    {{ if or .media_title .date }}
                    <span class="press-meta">
                        {{ if .media_title }}{{ .media_title }}{{ if .date }} | {{ end }}{{ end }}
                        {{ if .date }}{{ dateFormat "January 2, 2006" .date }}{{ end }}
                    </span>
                    {{ end }}
                    {{ if .description }}<span class="press-desc">{{ .description }}</span>{{ end }}
                </li>
            {{ end }}
            </ul>
        </div>
        {{ end }}
    {{ end }}
</article>

<style>
.page-nav {
    display: inline-flex;
    gap: 0.5rem;
    align-items: center;
    margin-bottom: 2rem;
    padding: 0;
    font-family: var(--font-display);
    font-size: 1.5rem;
    width: auto;
}

.nav-back, .nav-prev, .nav-next {
    color: var(--primary-color);
    text-decoration: none;
    opacity: 0.7;
    transition: opacity 0.3s ease;
}

.nav-disabled {
    color: var(--primary-color);
    opacity: 0.2;
}

.nav-back:hover, .nav-prev:hover, .nav-next:hover {
    opacity: 1;
}

@media (max-width: 768px) {
    .page-nav {
        gap: 0.5rem;
    }
}

.page-title {
    font-family: var(--font-structure);
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0;
}

/* Hero Section */
.gig-hero {
    display: grid;
    grid-template-columns: 40% 1fr;
    gap: 3rem;
    margin-bottom: 4rem;
}

.gig-hero-poster,
.gig-hero-info {
    position: relative;
    isolation: isolate;
}

.scanline {
    position: absolute;
    left: 0;
    right: 0;
    height: 1px;
    background: rgba(200, 200, 200, 0.9);
    box-shadow: 0 0 12px rgba(150, 150, 150, 0.8), 0 0 6px rgba(255, 255, 255, 0.6);
    pointer-events: none;
    z-index: 10;
    opacity: 0;
}

.gig-hero-info {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    padding-top: 2rem;
    position: relative;
}

.gig-hero-poster {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    isolation: isolate;
    overflow: hidden;
}

.gig-hero-info {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    padding-top: 2rem;
    position: relative;
    isolation: isolate;
    overflow: hidden;
}

.gig-hero-poster {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.poster-wrapper {
    position: relative;
}

.poster-image {
    width: 100%;
    height: auto;
    display: block;
    position: relative;
    z-index: 1;
    cursor: pointer;
}

.gig-hero-info {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    padding-top: 2rem;
    overflow: hidden;
}

.info-card {
    background: rgba(45, 45, 45, 0.6);
    border: 1px solid var(--border-color);
    padding: 1rem 1.5rem;
    position: relative;
    transition: all 0.3s ease;
    z-index: 3;
}

.poster-wrapper {
    position: relative;
    z-index: 3;
}

.info-card:hover {
    background: rgba(45, 45, 45, 0.8);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.card-title {
    clip-path: polygon(0 0, 100% 0, 100% 85%, 95% 100%, 0 100%);
    background: rgba(45, 45, 45, 0.8);
}

.card-title h1 {
    font-family: var(--font-structure);
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
    color: var(--primary-color);
}

.card-date {
    clip-path: polygon(5% 0, 100% 0, 100% 100%, 0 100%, 0 15%);
    margin-left: 2rem;
}

.card-venue {
    clip-path: polygon(0 0, 95% 0, 100% 15%, 100% 100%, 0 100%);
    margin-right: 2rem;
}

.card-performers {
    clip-path: polygon(0 0, 100% 0, 100% 100%, 8% 100%, 0 85%);
    margin-left: 1rem;
}

.card-link {
    clip-path: polygon(3% 0, 100% 0, 100% 100%, 0 100%, 0 20%);
    margin-left: 1.5rem;
    background: rgba(90, 90, 90, 0.4);
}

.card-link:hover {
    background: rgba(90, 90, 90, 0.7);
}

.info-card .label {
    display: block;
    font-family: var(--font-structure);
    font-size: 0.75rem;
    color: var(--secondary-color);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.5rem;
}

.info-card .value {
    display: block;
    font-family: var(--font-body);
    font-size: 1rem;
    color: var(--primary-color);
}

.info-card .sublabel {
    display: block;
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--secondary-color);
    margin-top: 0.25rem;
}

.info-card .performer {
    display: block;
    font-family: var(--font-body);
    font-size: 0.9rem;
    color: var(--primary-color);
    margin-top: 0.5rem;
}

.info-card .performer a {
    color: var(--primary-color);
    text-decoration: none;
    border-bottom: 1px solid var(--border-color);
    transition: border-color 0.3s ease;
}

.info-card .performer a:hover {
    border-color: var(--accent-color);
}

.event-link {
    font-family: var(--font-structure);
    font-size: 0.9rem;
    color: var(--primary-color);
    text-decoration: none;
    display: inline-block;
    transition: color 0.3s ease;
}

.event-link:hover {
    color: var(--accent-color);
}

/* Description */
.gig-description {
    max-width: 60%;
    margin: 0 0 4rem 10%;
    padding: 2rem;
    background: rgba(45, 45, 45, 0.4);
    border: 1px solid var(--border-color);
    font-family: var(--font-body);
    font-size: 0.9rem;
    line-height: 1.8;
    color: var(--primary-color);
}

/* Diagonal Divider */
.diagonal-divider {
    width: 100%;
    height: 2px;
    background: linear-gradient(to right, transparent 0%, var(--border-color) 20%, var(--border-color) 80%, transparent 100%);
    transform: skewY(-1deg);
    margin: 4rem 0;
}

/* Media Sections */
.media-section {
    margin-bottom: 4rem;
}

.media-section h2 {
    font-family: var(--font-structure);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1rem;
}

.media-credit {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--secondary-color);
    margin-bottom: 1.5rem;
}

.media-credit a {
    color: var(--primary-color);
    text-decoration: underline;
}

/* Video Grid */
.video-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-top: 2rem;
}

.video-item {
    position: relative;
}

.video-item a {
    display: block;
    position: relative;
    overflow: hidden;
}

.video-item img {
    width: 100%;
    height: auto;
    display: block;
    transition: transform 0.3s ease, filter 0.3s ease;
}

.video-item a:hover img {
    transform: scale(1.05);
    filter: brightness(1.1);
}

.video-item a:hover .play-icon {
    animation: pulse 1s ease infinite;
}

.play-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 4rem;
    color: white;
    text-shadow: 0 0 20px rgba(0,0,0,0.8);
    pointer-events: none;
}

@keyframes pulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; }
}

.media-info {
    margin-top: 0.5rem;
}

.media-title {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--secondary-color);
    margin: 0;
}

/* Media Grid - Masonry (waterfall) */
.photo-grid,
.video-grid,
.media-grid {
    column-count: 4;
    column-gap: 1rem;
    margin-top: 2rem;
}

.photo-item,
.video-item {
    position: relative;
    break-inside: avoid;
    margin-bottom: 1rem;
}

.photo-item a {
    display: block;
    position: relative;
    overflow: hidden;
}

.photo-item img {
    width: 100%;
    height: auto;
    display: block;
    transition: transform 0.3s ease;
}

.photo-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.8) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    align-items: flex-end;
    padding: 1rem;
}

.photo-item a:hover .photo-overlay {
    opacity: 1;
}

.photo-item a:hover img {
    transform: scale(1.05);
}

.photo-meta {
    font-family: var(--font-body);
    font-size: 0.8rem;
    color: var(--primary-color);
}

/* Press & Media */
.gig-others {
    margin-top: 4rem;
}

.gig-others h2 {
    font-family: var(--font-structure);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1.5rem;
}

.gig-others ul {
    list-style: none;
    padding: 0;
}

.press-item {
    padding: 1rem 0;
    border-bottom: 1px solid var(--border-color);
    transition: padding-left 0.3s ease;
}

.press-item:hover {
    padding-left: 1rem;
}

.press-type {
    font-family: var(--font-structure);
    font-size: 0.75rem;
    color: var(--secondary-color);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    display: block;
    margin-bottom: 0.5rem;
}

.press-link {
    font-family: var(--font-body);
    font-size: 1rem;
    color: var(--primary-color);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color 0.3s ease;
    display: inline-block;
}

.press-link:hover {
    border-color: var(--accent-color);
}

.press-meta {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--secondary-color);
    display: block;
    margin-top: 0.25rem;
}

.press-desc {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--secondary-color);
    display: block;
    margin-top: 0.5rem;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.press-item:hover .press-desc {
    max-height: 200px;
}

/* Lightbox Styles */
.swiper-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 2rem;
}

.swiper-modal-content {
    position: relative;
    max-width: 1200px;
    width: 100%;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    padding: 2rem;
}

.swiper-modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: var(--primary-color);
    font-size: 2rem;
    cursor: pointer;
    z-index: 10;
}

.swiper-modal-close:hover {
    color: var(--accent-color);
}

.swiper-modal-content img {
    width: 100%;
    max-height: 80vh;
    object-fit: contain;
    display: block;
    margin-bottom: 1rem;
}

.swiper-modal-content iframe {
    width: 100%;
    height: 500px;
    margin-bottom: 1rem;
}

.swiper-modal-info {
    color: var(--primary-color);
    font-size: 0.9rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.swiper-modal-info-left {
    flex: 1;
}

.swiper-modal-info p {
    margin: 0.5rem 0;
    font-family: var(--font-body);
}

.swiper-modal-info a {
    color: var(--primary-color);
    text-decoration: underline;
}

.swiper-modal-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid var(--border-color);
    color: var(--primary-color);
    font-size: 3rem;
    width: 60px;
    height: 60px;
    cursor: pointer;
    z-index: 10;
    transition: background 0.3s;
}

.swiper-modal-nav:hover {
    background: rgba(0, 0, 0, 0.8);
}

.swiper-modal-prev {
    left: 1rem;
}

.swiper-modal-next {
    right: 1rem;
}

.download-btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--accent-color);
    color: var(--primary-color);
    text-decoration: none;
    border: 1px solid var(--border-color);
    transition: background 0.3s;
    white-space: nowrap;
    font-family: var(--font-structure);
}

.download-btn:hover {
    background: var(--primary-color);
    color: var(--bg-primary);
}

.video-credits {
    margin-top: 0.5rem;
    font-size: 0.85rem;
    color: var(--secondary-color);
}

.video-credits p {
    margin: 0.25rem 0;
    font-family: var(--font-body);
}

/* Responsive */
@media (max-width: 1200px) {
    .photo-grid,
    .video-grid,
    .media-grid {
        column-count: 3;
    }
}

@media (max-width: 768px) {
    .gig-hero {
        grid-template-columns: 1fr;
        gap: 2rem;
        min-height: auto;
    }
    
    .gig-hero-info {
        padding-top: 0;
    }
    
    .info-card {
        margin-left: 0 !important;
        margin-right: 0 !important;
        clip-path: none !important;
    }
    
    .card-title h1 {
        font-size: 1.5rem;
        text-align: center;
    }
    
    .info-card .label,
    .info-card .value,
    .info-card .sublabel {
        text-align: center;
    }
    
    .gig-description {
        max-width: 100%;
        margin: 0 0 3rem 0;
    }
    
    .photo-grid,
    .video-grid,
    .media-grid {
        column-count: 2;
    }
}

@media (max-width: 480px) {
    .swiper-modal {
        padding: 1rem;
    }
    
    .swiper-modal-content {
        padding: 1rem;
    }
    
    .swiper-modal-nav {
        width: 40px;
        height: 40px;
        font-size: 2rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Unified Scanline Effect
    const hero = document.querySelector('.gig-hero');
    const cards = document.querySelectorAll('.gig-hero .info-card');
    const poster = document.querySelector('.poster-wrapper');
    const targets = [...cards];
    if (poster) targets.push(poster);
    
    if (hero && targets.length > 0) {
        const heroTop = hero.offsetTop;
        const heroHeight = hero.offsetHeight;
        
        // Create scanline elements inside each target
        targets.forEach(target => {
            const scanline = document.createElement('div');
            scanline.className = 'scanline';
            target.style.position = 'relative';
            target.style.overflow = 'hidden';
            target.appendChild(scanline);
        });
        
        function updateScanline() {
            const now = Date.now();
            const duration = 10000;
            const cycle = (now % (duration * 2)) / duration;
            const progress = cycle <= 1 ? cycle : 2 - cycle; // 0->1->0
            
            // Get hero position relative to document
            const heroRect = hero.getBoundingClientRect();
            const heroScrollTop = window.pageYOffset + heroRect.top;
            const globalScanlinePos = heroHeight * progress;
            
            targets.forEach(target => {
                const targetRect = target.getBoundingClientRect();
                const targetScrollTop = window.pageYOffset + targetRect.top;
                const targetTop = targetScrollTop - heroScrollTop;
                const targetBottom = targetTop + target.offsetHeight;
                const scanline = target.querySelector('.scanline');
                
                if (globalScanlinePos >= targetTop && globalScanlinePos <= targetBottom) {
                    const localPos = globalScanlinePos - targetTop;
                    scanline.style.top = `${localPos}px`;
                    scanline.style.opacity = '0.9';
                } else {
                    scanline.style.opacity = '0';
                }
            });
            
            requestAnimationFrame(updateScanline);
        }
        
        updateScanline();
    }
    
    // Image Lightbox
    const imageLightboxLinks = document.querySelectorAll('.open-lightbox');
    imageLightboxLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const imageUrl = this.dataset.imageUrl;
            const originalUrl = this.dataset.originalUrl;
            const gigTitle = this.dataset.gigTitle;
            const gigLink = this.dataset.gigLink;
            const author = this.dataset.author;
            const authorUrl = this.dataset.authorUrl;
            
            const modal = document.createElement('div');
            modal.className = 'swiper-modal';
            modal.innerHTML = `
                <div class="swiper-modal-content">
                    <button class="swiper-modal-close">&times;</button>
                    <button class="swiper-modal-nav swiper-modal-prev">‹</button>
                    <button class="swiper-modal-nav swiper-modal-next">›</button>
                    <img src="${imageUrl}" alt="${gigTitle}">
                    <div class="swiper-modal-info">
                        <div class="swiper-modal-info-left">
                            <p><strong>Gig:</strong> <a href="${gigLink}">${gigTitle}</a></p>
                            ${author ? `<p><strong>Photo by:</strong> ${authorUrl ? `<a href="${authorUrl}" target="_blank">${author}</a>` : author}</p>` : ''}
                        </div>
                        <a href="${originalUrl}" download class="download-btn">Download</a>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            const allImages = Array.from(imageLightboxLinks);
            const currentIndex = allImages.indexOf(this);
            
            modal.querySelector('.swiper-modal-prev').addEventListener('click', () => {
                const prevIndex = (currentIndex - 1 + allImages.length) % allImages.length;
                modal.remove();
                allImages[prevIndex].click();
            });
            
            modal.querySelector('.swiper-modal-next').addEventListener('click', () => {
                const nextIndex = (currentIndex + 1) % allImages.length;
                modal.remove();
                allImages[nextIndex].click();
            });
            
            modal.querySelector('.swiper-modal-close').addEventListener('click', () => {
                modal.remove();
            });
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        });
    });

    // Video Lightbox
    const videoLightboxLinks = document.querySelectorAll('.open-video-lightbox');
    videoLightboxLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const youtubeId = this.dataset.youtubeId;
            const title = this.dataset.title;
            const gigTitle = this.dataset.gigTitle;
            const gigLink = this.dataset.gigLink;
            const credits = this.dataset.credits ? JSON.parse(this.dataset.credits) : [];
            
            let creditsHtml = '';
            if (credits.length > 0) {
                creditsHtml = '<div class="video-credits">';
                credits.forEach(credit => {
                    creditsHtml += `<p>${credit.type} by ${credit.url ? `<a href="${credit.url}" target="_blank">${credit.name}</a>` : credit.name}</p>`;
                });
                creditsHtml += '</div>';
            }
            
            const modal = document.createElement('div');
            modal.className = 'swiper-modal';
            modal.innerHTML = `
                <div class="swiper-modal-content">
                    <button class="swiper-modal-close">&times;</button>
                    <button class="swiper-modal-nav swiper-modal-prev">‹</button>
                    <button class="swiper-modal-nav swiper-modal-next">›</button>
                    <iframe width="100%" height="500" src="https://www.youtube.com/embed/${youtubeId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="swiper-modal-info">
                        <div class="swiper-modal-info-left">
                            ${title ? `<p><strong>Title:</strong> ${title}</p>` : ''}
                            <p><strong>Gig:</strong> <a href="${gigLink}">${gigTitle}</a></p>
                            ${creditsHtml}
                        </div>
                        <a href="https://www.youtube.com/watch?v=${youtubeId}" target="_blank" class="download-btn">Open</a>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            const allVideos = Array.from(videoLightboxLinks);
            const currentIndex = allVideos.indexOf(this);
            
            modal.querySelector('.swiper-modal-prev').addEventListener('click', () => {
                const prevIndex = (currentIndex - 1 + allVideos.length) % allVideos.length;
                modal.remove();
                allVideos[prevIndex].click();
            });
            
            modal.querySelector('.swiper-modal-next').addEventListener('click', () => {
                const nextIndex = (currentIndex + 1) % allVideos.length;
                modal.remove();
                allVideos[nextIndex].click();
            });
            
            modal.querySelector('.swiper-modal-close').addEventListener('click', () => {
                modal.remove();
            });
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        });
    });
});
</script>
{{ end }}
