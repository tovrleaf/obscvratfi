{{/*
    Media Page Template
    
    Design Patterns:
    ----------------
    
    HOVER EFFECTS (Photos & Videos):
    - scale(1.05) - Subtle zoom on hover, contained by overflow:hidden
    - blur(2px) - Softens image to emphasize text overlay
    - brightness(0.5) - Dims to 50% for better text contrast
    - opacity 0→1 transition on .media-info overlay
    
    TEXT OVERLAYS:
    - Photos: Dark background (rgba(0,0,0,0.8)) only on event title
    - Videos: Dark background on all text elements (title, date, venue)
    - Text shadows: 0 0 8px and 0 0 4px for readability on any background
    - No underlines on hover overlay links
    
    TYPOGRAPHY:
    - Event names: h3 tags, normal weight
    - Dates: Fira Mono (var(--font-display)), 0.9rem
    - Photo credits: Camera icon (fa-camera) + photographer name
    - Dotted separator: Only between date and photographer (photos only)
    
    OTHERS SECTION:
    - Date first (Fira Mono, secondary color)
    - 4ch spacing before title
    - Type in superscript after title
    - Description indented below if present
*/}}

{{ define "main" }}
<section class="media-page">
    <h1>{{ .Title }}</h1>
    {{ if .Content }}<div class="intro">{{ .Content }}</div>{{ end }}
    
    <!-- Filter buttons -->
    <div class="media-filters">
        <button class="filter-btn active" data-filter="all">
            All
            <span aria-hidden class="filter-btn__glitch">All</span>
        </button>
        <button class="filter-btn" data-filter="photos">
            Photos
            <span aria-hidden class="filter-btn__glitch">Photos</span>
        </button>
        <button class="filter-btn" data-filter="videos">
            Videos
            <span aria-hidden class="filter-btn__glitch">Videos</span>
        </button>
        <button class="filter-btn" data-filter="others">
            Others
            <span aria-hidden class="filter-btn__glitch">Others</span>
        </button>
    </div>
    
    <!-- Photos Section -->
    <section class="media-section photos-section" data-type="photos">
        <h2>Photos</h2>
        <div class="media-grid">
            {{ $gigs := (where .Site.Pages "Section" "live").ByDate.Reverse }}
            {{ range $gigs }}
                {{ if .Params.media.pictures }}
                    {{ $gigTitle := .Title }}
                    {{ $gigPermalink := .Permalink }}
                    {{ $gigSlug := strings.TrimSuffix "/" (strings.TrimPrefix "/live/" .RelPermalink) }}
                    {{ $author := .Params.media.pictures.author }}
                    {{ $authorUrl := .Params.media.pictures.author_url }}
                    {{ $location := .Params.location }}
                    {{ $date := .Date.Format "January 2, 2006" }}
                    {{ range $index, $image := .Params.media.pictures.images }}
                        {{ $imagePath := printf "media/live/%s/%s" $gigSlug $image }}
                        {{ with resources.Get $imagePath }}
                            {{ $altText := printf "Obscvrat live at %s, %s, %s - Photo by %s" $gigTitle $location $date $author }}
                            <div class="media-item photo-item">
                                <a href="#" class="open-lightbox" 
                                   data-gig="{{ $gigSlug }}" 
                                   data-image="{{ $image }}"
                                   data-gig-title="{{ $gigTitle }}"
                                   data-gig-link="{{ $gigPermalink }}"
                                   data-author="{{ $author }}"
                                   data-author-url="{{ $authorUrl }}">
                                    <img src="{{ .RelPermalink }}" alt="{{ $altText }}">
                                </a>
                                <div class="media-info">
                                    <h3 class="media-gig"><a href="{{ $gigPermalink }}">{{ $gigTitle }}</a></h3>
                                    <p class="media-date">{{ $date }}</p>
                                    <p class="media-author">
                                    {{ if $authorUrl }}
                                        <i class="fa-solid fa-camera"></i> <a href="{{ $authorUrl }}" target="_blank">{{ $author }}</a>
                                    {{ else }}
                                        <i class="fa-solid fa-camera"></i> {{ $author }}
                                    {{ end }}
                                </p>
                            </div>
                        </div>
                        {{ end }}
                    {{ end }}
                {{ end }}
            {{ end }}
            
            {{ $standalonePics := where .Site.Pages "Section" "media" }}
            {{ $standalonePics := where $standalonePics "Params.type" "picture" }}
            {{ range $standalonePics }}
                <div class="media-item photo-item">
                    <img src="{{ .Params.image }}" alt="{{ .Title }}">
                    <div class="media-info">
                        <p class="media-title">{{ .Title }}</p>
                        {{ if .Params.gig }}
                            {{ $gigPage := $.Site.GetPage (printf "/live/%s" .Params.gig) }}
                            {{ if $gigPage }}
                                <p class="media-gig"><a href="{{ $gigPage.Permalink }}">{{ $gigPage.Title }}</a></p>
                            {{ end }}
                        {{ end }}
                        <p class="media-author">
                            {{ if .Params.author_url }}
                                <i class="fa-solid fa-camera"></i> <a href="{{ .Params.author_url }}" target="_blank">{{ .Params.author }}</a>
                            {{ else }}
                                <i class="fa-solid fa-camera"></i> {{ .Params.author }}
                            {{ end }}
                        </p>
                    </div>
                </div>
            {{ end }}
        </div>
    </section>
    
    <!-- Videos Section -->
    <section class="media-section videos-section" data-type="videos">
        <h2>Videos</h2>
        <div class="media-grid">
            {{ range $gigs }}
                {{ if .Params.media.videos }}
                    {{ $gigTitle := .Title }}
                    {{ $gigPermalink := .Permalink }}
                    {{ $gigDate := .Date.Format "January 2, 2006" }}
                    {{ range .Params.media.videos }}
                        <div class="media-item video-item">
                            <a href="#" class="open-video-lightbox"
                               data-youtube-id="{{ .youtube_id }}"
                               data-title="{{ .title }}{{ if .date }} | {{ .date }}{{ end }}"
                               data-gig-title="{{ $gigTitle }}"
                               data-gig-link="{{ $gigPermalink }}"
                               {{ if .credits }}
                               data-credits='{{ .credits | jsonify }}'
                               {{ end }}>
                                <img src="https://img.youtube.com/vi/{{ .youtube_id }}/mqdefault.jpg" alt="{{ .title }}">
                                <div class="play-icon">▶</div>
                            </a>
                            <div class="media-info">
                                <h3 class="media-gig"><a href="{{ $gigPermalink }}">{{ $gigTitle }}</a></h3>
                                <p class="media-date">{{ $gigDate }}</p>
                                {{ if .title }}<h3 class="media-title">{{ .title }}</h3>{{ end }}
                            </div>
                        </div>
                    {{ end }}
                {{ end }}
            {{ end }}
            
            {{ $standaloneVids := where .Site.Pages "Section" "media" }}
            {{ $standaloneVids := where $standaloneVids "Params.type" "video" }}
            {{ range $standaloneVids }}
                <div class="media-item video-item">
                    <img src="https://img.youtube.com/vi/{{ .Params.youtube_id }}/mqdefault.jpg" alt="{{ .Title }}">
                    <div class="play-icon">▶</div>
                    <div class="media-info">
                        <p class="media-title">{{ .Title }}</p>
                        {{ if .Params.gig }}
                            {{ $gigPage := $.Site.GetPage (printf "/live/%s" .Params.gig) }}
                            {{ if $gigPage }}
                                <p class="media-gig"><a href="{{ $gigPage.Permalink }}">{{ $gigPage.Title }}</a></p>
                            {{ end }}
                        {{ end }}
                    </div>
                </div>
            {{ end }}
        </div>
    </section>
    
    <!-- Others Section -->
    <section class="media-section others-section" data-type="others">
        <h2>Others</h2>
        {{ $othersPage := .Site.GetPage "/media/others" }}
        {{ if and $othersPage $othersPage.Params.items }}
            <div class="others-list">
                {{ range $othersPage.Params.items }}
                <div class="others-item">
                    <span class="others-date">{{ dateFormat "January 2, 2006" .date }}</span>
                    <a href="{{ .url }}" target="_blank" class="others-title">
                        {{ if .media_title }}<span class="others-media-title">{{ .media_title }}</span> ‣ {{ end }}<strong>{{ .title }}</strong>
                    </a><sup class="others-type">{{ .type }}</sup>
                    {{ if .description }}<p class="others-description">{{ .description }}</p>{{ end }}
                </div>
                {{ end }}
            </div>
        {{ else }}
            <p>No interviews, mentions, or reviews yet.</p>
        {{ end }}
    </section>
</section>

<style>
/* 
   Media Page Styles
   
   Key Design Values:
   - Hover zoom: scale(1.05)
   - Hover blur: 2px
   - Hover dim: brightness(0.5) - 50% darker
   - Dark overlay: rgba(0,0,0,0.8)
   - Text shadow: 0 0 8px + 0 0 4px for strong contrast
   - Tab spacing: 4ch (Others section)
*/

.media-filters {
    margin: 2rem 0;
    display: flex;
    gap: 1rem;
}

.filter-btn {
    --primary: rgba(255, 255, 255, 0.1);
    --shadow-primary: rgba(100, 100, 100, 0.5);
    --shadow-secondary: rgba(150, 150, 150, 0.3);
    --clip: polygon(0 0, 100% 0, 100% 100%, 95% 100%, 95% 90%, 85% 90%, 85% 100%, 8% 100%, 0 70%);
    --shimmy-distance: 5;
    --clip-one: polygon(0 2%, 100% 2%, 100% 95%, 95% 95%, 95% 90%, 85% 90%, 85% 95%, 8% 95%, 0 70%);
    --clip-two: polygon(0 78%, 100% 78%, 100% 100%, 95% 100%, 95% 90%, 85% 90%, 85% 100%, 8% 100%, 0 78%);
    --clip-three: polygon(0 44%, 100% 44%, 100% 54%, 95% 54%, 95% 54%, 85% 54%, 85% 54%, 8% 54%, 0 54%);
    --clip-four: polygon(0 0, 100% 0, 100% 0, 95% 0, 95% 0, 85% 0, 85% 0, 8% 0, 0 0);
    --clip-five: polygon(0 0, 100% 0, 100% 0, 95% 0, 95% 0, 85% 0, 85% 0, 8% 0, 0 0);
    --clip-six: polygon(0 40%, 100% 40%, 100% 85%, 95% 85%, 95% 85%, 85% 85%, 85% 85%, 8% 85%, 0 70%);
    --clip-seven: polygon(0 63%, 100% 63%, 100% 80%, 95% 80%, 95% 80%, 85% 80%, 85% 80%, 8% 80%, 0 70%);
    
    background: transparent;
    color: var(--primary-color);
    border: 0;
    padding: 0.5rem 1rem;
    cursor: pointer;
    font-family: var(--font-display);
    position: relative;
    text-transform: uppercase;
    letter-spacing: 2px;
    outline: transparent;
}

.filter-btn:after,
.filter-btn:before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    clip-path: var(--clip);
    z-index: -1;
}

.filter-btn:before {
    background: var(--shadow-primary);
    transform: translate(2px, 0);
}

.filter-btn:after {
    background: var(--primary);
}

.filter-btn:hover:after {
    background: rgba(255, 255, 255, 0.15);
}

.filter-btn.active:after {
    background: rgba(255, 255, 255, 0.2);
}

.filter-btn__glitch {
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: var(--shadow-primary);
    text-shadow: 2px 2px var(--shadow-primary), -2px -2px var(--shadow-secondary);
    clip-path: var(--clip);
    animation: glitch 2s infinite;
    display: none;
}

.filter-btn:hover .filter-btn__glitch {
    display: block;
}

.filter-btn__glitch:before {
    content: '';
    position: absolute;
    top: 2px;
    right: 2px;
    bottom: 2px;
    left: 2px;
    clip-path: var(--clip);
    background: var(--primary);
    z-index: -1;
}

@keyframes glitch {
    0% {
        clip-path: var(--clip-one);
    }
    2%, 8% {
        clip-path: var(--clip-two);
        transform: translate(calc(var(--shimmy-distance) * -1%), 0);
    }
    6% {
        clip-path: var(--clip-two);
        transform: translate(calc(var(--shimmy-distance) * 1%), 0);
    }
    9% {
        clip-path: var(--clip-two);
        transform: translate(0, 0);
    }
    10% {
        clip-path: var(--clip-three);
        transform: translate(calc(var(--shimmy-distance) * 1%), 0);
    }
    13% {
        clip-path: var(--clip-three);
        transform: translate(0, 0);
    }
    14%, 21% {
        clip-path: var(--clip-four);
        transform: translate(calc(var(--shimmy-distance) * 1%), 0);
    }
    25% {
        clip-path: var(--clip-five);
        transform: translate(calc(var(--shimmy-distance) * 1%), 0);
    }
    30% {
        clip-path: var(--clip-five);
        transform: translate(calc(var(--shimmy-distance) * -1%), 0);
    }
    35%, 45% {
        clip-path: var(--clip-six);
        transform: translate(calc(var(--shimmy-distance) * -1%));
    }
    40% {
        clip-path: var(--clip-six);
        transform: translate(calc(var(--shimmy-distance) * 1%));
    }
    50% {
        clip-path: var(--clip-six);
        transform: translate(0, 0);
    }
    55% {
        clip-path: var(--clip-seven);
        transform: translate(calc(var(--shimmy-distance) * 1%), 0);
    }
    60% {
        clip-path: var(--clip-seven);
        transform: translate(0, 0);
    }
    31%, 61%, 100% {
        clip-path: var(--clip-four);
    }
}

.media-section {
    margin: 3rem 0;
}

.media-section.hidden {
    display: none;
}

.media-grid {
    column-count: 4;
    column-gap: 1rem;
    margin-top: 2rem;
}

.media-item {
    position: relative;
    break-inside: avoid;
    margin-bottom: 1rem;
    overflow: hidden;
}

.media-item a {
    display: block;
    position: relative;
    overflow: hidden;
}

.media-item img {
    width: 100%;
    height: auto;
    display: block;
    transition: transform 0.3s ease, filter 0.3s ease;
}

.media-item:hover img {
    transform: scale(1.05);
    filter: blur(2px) brightness(0.5);
}

.media-item video {
    width: 100%;
    height: auto;
    display: block;
}

.play-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 3rem;
    color: white;
    text-shadow: 0 0 10px rgba(0,0,0,0.8);
    pointer-events: none;
}

.media-info {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 1rem;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    font-size: 0.85rem;
    background: rgba(0, 0, 0, 0.3);
}

.media-item:hover .media-info {
    opacity: 1;
}

.media-title {
    font-weight: normal;
    margin-bottom: 0.5rem;
    color: var(--primary-color);
    text-shadow: 0 0 8px rgba(0, 0, 0, 0.9), 0 0 4px rgba(0, 0, 0, 0.9);
    font-size: 0.85rem;
}

.video-item .media-title {
    background: rgba(0, 0, 0, 0.8);
    padding: 0.5rem;
}

.media-gig {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
    text-shadow: 0 0 8px rgba(0, 0, 0, 0.9), 0 0 4px rgba(0, 0, 0, 0.9);
    font-size: 0.85rem;
    font-weight: normal;
    background: rgba(0, 0, 0, 0.8);
    padding: 0.5rem;
}

.media-gig a {
    color: var(--primary-color);
    text-decoration: none;
}

.media-date {
    font-family: var(--font-display);
    color: var(--primary-color);
    margin-bottom: 0.5rem;
    text-shadow: 0 0 8px rgba(0, 0, 0, 0.9), 0 0 4px rgba(0, 0, 0, 0.9);
    font-size: 0.9rem;
}

.video-item .media-date {
    background: rgba(0, 0, 0, 0.8);
    padding: 0.5rem;
}

.photo-item .media-date {
    padding-bottom: 0.5rem;
    border-bottom: 1px dotted rgba(255, 255, 255, 0.3);
    max-width: 60%;
    margin-left: auto;
    margin-right: auto;
}

.media-author {
    color: var(--primary-color);
    text-shadow: 0 0 8px rgba(0, 0, 0, 0.9), 0 0 4px rgba(0, 0, 0, 0.9);
    white-space: nowrap;
}

.media-author a {
    color: var(--primary-color);
    text-decoration: none;
}


.others-content {
    max-width: 800px;
}

.others-item {
    margin-bottom: 1.5rem;
}

.others-date {
    font-family: var(--font-display);
    color: var(--secondary-color);
    font-size: 0.9rem;
    display: inline-block;
    margin-right: 4ch;
}

.others-title {
    color: var(--primary-color);
    text-decoration: none;
}

.others-title:hover {
    color: var(--accent-color);
}

.others-media-title {
    font-family: var(--font-display);
}

.others-type {
    color: var(--secondary-color);
    font-size: 0.7rem;
    margin-left: 0.3rem;
}

.others-description {
    margin-top: 0.5rem;
    margin-left: calc(4ch + 10rem);
    color: var(--secondary-color);
    font-size: 0.9rem;
}

.others-content h2 {
    margin-top: 2rem;
    margin-bottom: 1rem;
}

.others-content ul {
    list-style: none;
    padding: 0;
}

.others-content li {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
    position: relative;
}

.others-content li:before {
    content: "→";
    position: absolute;
    left: 0;
}

/* Swiper Modal */
.swiper-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 2rem;
}

.swiper-modal-content {
    position: relative;
    max-width: 1200px;
    width: 100%;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    padding: 2rem;
}

.swiper-modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: var(--primary-color);
    font-size: 2rem;
    cursor: pointer;
    z-index: 10;
}

.swiper-modal-close:hover {
    color: var(--accent-color);
}

.swiper-modal-content img {
    width: 100%;
    max-height: 80vh;
    object-fit: contain;
    display: block;
    margin-bottom: 1rem;
}

.swiper-modal-content iframe {
    width: 100%;
    max-height: 80vh;
    margin-bottom: 1rem;
}

.swiper-modal-info {
    color: var(--primary-color);
    font-size: 0.9rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.swiper-modal-info-left {
    flex: 1;
}

.swiper-modal-info p {
    margin: 0.5rem 0;
}

.swiper-modal-info a {
    color: var(--primary-color);
    text-decoration: underline;
}

.swiper-modal-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid var(--border-color);
    color: var(--primary-color);
    font-size: 3rem;
    width: 60px;
    height: 60px;
    cursor: pointer;
    z-index: 10;
    transition: background 0.3s;
}

.swiper-modal-nav:hover {
    background: rgba(0, 0, 0, 0.8);
}

.swiper-modal-prev {
    left: 1rem;
}

.swiper-modal-next {
    right: 1rem;
}

.download-btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--accent-color);
    color: var(--primary-color);
    text-decoration: none;
    border: 1px solid var(--border-color);
    transition: background 0.3s;
    white-space: nowrap;
}

.download-btn:hover {
    background: var(--primary-color);
    color: var(--bg-primary);
}

.video-credits {
    margin-top: 0.5rem;
    font-size: 0.85rem;
    color: var(--secondary-color);
}

.video-credits p {
    margin: 0.25rem 0;
}

/* Responsive masonry columns */
@media (max-width: 1200px) {
    .media-grid {
        column-count: 3;
    }
}

@media (max-width: 768px) {
    .media-grid {
        column-count: 2;
    }
    
    .swiper-modal {
        padding: 1rem;
    }
    
    .swiper-modal-content {
        padding: 1rem;
    }
}

@media (max-width: 480px) {
    .media-grid {
        column-count: 2;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const sections = document.querySelectorAll('.media-section');
    
    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.dataset.filter;
            
            // Update active button
            filterBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Show/hide sections
            sections.forEach(section => {
                if (filter === 'all') {
                    section.classList.remove('hidden');
                } else {
                    if (section.dataset.type === filter) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                }
            });
        });
    });

    // Image Lightbox
    const imageLightboxLinks = document.querySelectorAll('.open-lightbox');
    imageLightboxLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const gig = this.dataset.gig;
            const image = this.dataset.image;
            const gigTitle = this.dataset.gigTitle;
            const gigLink = this.dataset.gigLink;
            const author = this.dataset.author;
            const authorUrl = this.dataset.authorUrl;
            
            const modal = document.createElement('div');
            modal.className = 'swiper-modal';
            modal.innerHTML = `
                <div class="swiper-modal-content">
                    <button class="swiper-modal-close">&times;</button>
                    <button class="swiper-modal-nav swiper-modal-prev">‹</button>
                    <button class="swiper-modal-nav swiper-modal-next">›</button>
                    <img src="/media/live/${gig}/${image}" alt="${gigTitle}">
                    <div class="swiper-modal-info">
                        <div class="swiper-modal-info-left">
                            <p><strong>Live @</strong> <a href="${gigLink}">${gigTitle}</a></p>
                            <p><strong>Photo by:</strong> ${authorUrl ? `<a href="${authorUrl}" target="_blank">${author}</a>` : author}</p>
                        </div>
                        <a href="/media/live/${gig}/${image}" download class="download-btn">Download</a>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Navigation
            const allImages = Array.from(imageLightboxLinks);
            const currentIndex = allImages.indexOf(this);
            
            modal.querySelector('.swiper-modal-prev').addEventListener('click', () => {
                const prevIndex = (currentIndex - 1 + allImages.length) % allImages.length;
                modal.remove();
                allImages[prevIndex].click();
            });
            
            modal.querySelector('.swiper-modal-next').addEventListener('click', () => {
                const nextIndex = (currentIndex + 1) % allImages.length;
                modal.remove();
                allImages[nextIndex].click();
            });
            
            modal.querySelector('.swiper-modal-close').addEventListener('click', () => {
                modal.remove();
            });
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        });
    });

    // Video Lightbox
    const videoLightboxLinks = document.querySelectorAll('.open-video-lightbox');
    videoLightboxLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const youtubeId = this.dataset.youtubeId;
            const title = this.dataset.title;
            const gigTitle = this.dataset.gigTitle;
            const gigLink = this.dataset.gigLink;
            const credits = this.dataset.credits ? JSON.parse(this.dataset.credits) : [];
            
            let creditsHtml = '';
            if (credits.length > 0) {
                creditsHtml = '<div class="video-credits">';
                credits.forEach(credit => {
                    creditsHtml += `<p>${credit.type} by ${credit.url ? `<a href="${credit.url}" target="_blank">${credit.name}</a>` : credit.name}</p>`;
                });
                creditsHtml += '</div>';
            }
            
            const modal = document.createElement('div');
            modal.className = 'swiper-modal';
            modal.innerHTML = `
                <div class="swiper-modal-content">
                    <button class="swiper-modal-close">&times;</button>
                    <button class="swiper-modal-nav swiper-modal-prev">‹</button>
                    <button class="swiper-modal-nav swiper-modal-next">›</button>
                    <iframe width="100%" height="500" src="https://www.youtube.com/embed/${youtubeId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="swiper-modal-info">
                        <div class="swiper-modal-info-left">
                            ${title ? `<p><strong>Title:</strong> ${title}</p>` : ''}
                            <p><strong>Live @</strong> <a href="${gigLink}">${gigTitle}</a></p>
                            ${creditsHtml}
                        </div>
                        <a href="https://www.youtube.com/watch?v=${youtubeId}" target="_blank" class="download-btn">Open</a>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Navigation
            const allVideos = Array.from(videoLightboxLinks);
            const currentIndex = allVideos.indexOf(this);
            
            modal.querySelector('.swiper-modal-prev').addEventListener('click', () => {
                const prevIndex = (currentIndex - 1 + allVideos.length) % allVideos.length;
                modal.remove();
                allVideos[prevIndex].click();
            });
            
            modal.querySelector('.swiper-modal-next').addEventListener('click', () => {
                const nextIndex = (currentIndex + 1) % allVideos.length;
                modal.remove();
                allVideos[nextIndex].click();
            });
            
            modal.querySelector('.swiper-modal-close').addEventListener('click', () => {
                modal.remove();
            });
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        });
    });
});
</script>
{{ end }}
