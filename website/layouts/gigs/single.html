{{ define "main" }}
<article class="gig-detail">
    <h1>{{ .Title }}</h1>
    <div class="gig-details">
        <p><strong>Date:</strong> {{ .Date | dateFormat "Monday, January 2, 2006" }}</p>
        <p><strong>Venue:</strong> {{ .Params.venue }}</p>
        <p><strong>Location:</strong> {{ .Params.location }}</p>
        {{ if .Params.event_link }}<p><strong>Event:</strong> <a href="{{ .Params.event_link }}" target="_blank">View event page</a></p>{{ end }}
        {{ if .Params.other_performers }}
        <p><strong>Also performing:</strong></p>
        <ul>
        {{ range .Params.other_performers }}
            <li>
            {{ if .url }}
                <a href="{{ .url }}" target="_blank">{{ .name }}</a>
            {{ else }}
                {{ .name }}
            {{ end }}
            </li>
        {{ end }}
        </ul>
        {{ end }}
        {{ if .Params.time }}<p><strong>Time:</strong> {{ .Params.time }}</p>{{ end }}
        {{ if .Params.ticket_link }}<p><a href="{{ .Params.ticket_link }}" target="_blank">Get Tickets</a></p>{{ end }}
    </div>
    
    {{ if .Params.youtube }}
    <div class="gig-video">
        <h2>Performance Video</h2>
        {{ $url := .Params.youtube }}
        {{ if strings.Contains $url "youtube.com" }}
            {{ $parts := strings.Split $url "v=" }}
            {{ if gt (len $parts) 1 }}
                {{ $qpart := index $parts 1 }}
                {{ $vid := index (strings.Split $qpart "?") 0 }}
                <iframe width="100%" height="400" src="https://www.youtube.com/embed/{{ $vid }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            {{ end }}
        {{ else if strings.Contains $url "youtu.be" }}
            {{ $parts := strings.Split $url "youtu.be/" }}
            {{ if gt (len $parts) 1 }}
                {{ $qpart := index $parts 1 }}
                {{ $vid := index (strings.Split $qpart "?") 0 }}
                <iframe width="100%" height="400" src="https://www.youtube.com/embed/{{ $vid }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            {{ end }}
        {{ end }}
    </div>
    {{ end }}
    
    {{ if .Content }}
    <div class="gig-description">
        {{ .Content }}
    </div>
    {{ end }}

    {{ if .Params.media }}
    <div class="gig-media">
        {{ if .Params.media.pictures }}
        <section class="media-section">
            <h2>Photos</h2>
            {{ if .Params.media.pictures.author }}
            <p class="media-credit">
                Photos by 
                {{ if .Params.media.pictures.author_url }}
                    <a href="{{ .Params.media.pictures.author_url }}" target="_blank">{{ .Params.media.pictures.author }}</a>
                {{ else }}
                    {{ .Params.media.pictures.author }}
                {{ end }}
            </p>
            {{ end }}
            <div class="media-gallery">
                {{ $gigSlug := path.Base .File.Dir }}
                {{ range .Params.media.pictures.images }}
                    {{ $imagePath := printf "media/gigs/%s/%s" $gigSlug . }}
                    {{ with resources.Get $imagePath }}
                        {{ $thumb := .Resize "400x q75" }}
                        {{ $display := .Resize "1200x q75" }}
                        <a href="{{ $display.RelPermalink }}" class="media-item" data-type="image">
                            <img src="{{ $thumb.RelPermalink }}" alt="Photo from {{ $.Title }}" loading="lazy">
                        </a>
                    {{ end }}
                {{ end }}
            </div>
        </section>
        {{ end }}

        {{ if .Params.media.videos }}
        <section class="media-section">
            <h2>Videos</h2>
            <div class="media-gallery">
                {{ range .Params.media.videos }}
                    <div class="media-item video-item">
                        {{ if .title }}<h3>{{ .title }}</h3>{{ end }}
                        {{ if .youtube_id }}
                            <iframe width="100%" height="400" src="https://www.youtube.com/embed/{{ .youtube_id }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        {{ end }}
                        {{ if .credits }}
                        <div class="video-credits">
                            {{ range .credits }}
                                <p class="credit-item">
                                    <strong>{{ .type }} by:</strong>
                                    {{ if .url }}
                                        <a href="{{ .url }}" target="_blank">{{ .name }}</a>
                                    {{ else }}
                                        {{ .name }}
                                    {{ end }}
                                </p>
                            {{ end }}
                        </div>
                        {{ end }}
                    </div>
                {{ end }}
            </div>
        </section>
        {{ end }}
    </div>
    {{ end }}
</article>
{{ end }}
